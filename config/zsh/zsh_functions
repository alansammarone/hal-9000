clp() {
    bun run claude --model haiku -p "You are being invoked from the terminal in non-interactive mode. Provide concise answers and explicitly warn the user when a command is destructive or irreversible. The user request is: \n $*" | nvim -c "set buftype=nofile bufhidden=wipe noswapfile" -
}


# Play media with mpv - works with audio/video
# Usage: m          -> opens broot picker (searches ~/Music/Library)
#        m <dir>    -> opens broot picker (searches specified directory)
# Keys: Tab to select/unselect, Enter to play selection
m() {
    local base_dir="${1:-$HOME/Music/Library/}"
    local selected=$(broot "$base_dir")
    [[ -n "$selected" ]] && mpv --shuffle --loop-playlist=inf ${(f)selected}
}

# Create new kitty tab in current tmux pane's directory
nt() {
    local cwd=$(tmux display-message -p '#{pane_current_path}' 2>/dev/null)
    kitty @ launch --type=tab --cwd="${cwd:-$HOME}" &>/dev/null
}

# Switch to AirPods (prefer eqMac version if available)
airpods() {
    local current=$(SwitchAudioSource -c)
    local all_devices=$(SwitchAudioSource -a)

    local airpods_devices=$(echo "$all_devices" | grep -i "airpods")

    if [[ -z "$airpods_devices" ]]; then
        echo "No AirPods devices found"
        return 1
    fi

    local eqmac_airpods=$(echo "$airpods_devices" | grep -i "eqmac")
    local target=""

    if [[ -n "$eqmac_airpods" ]]; then
        target="$eqmac_airpods"
    else
        target=$(echo "$airpods_devices" | head -n 1)
    fi

    if [[ "$current" == "$target" ]]; then
        echo "Already using: $target"
        return 0
    fi

    SwitchAudioSource -s "$target"
    echo "Switched to: $target"
}
